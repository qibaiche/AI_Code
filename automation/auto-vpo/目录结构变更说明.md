# 目录结构变更说明

## 变更日期
2025-12-26

## 变更内容

### 旧结构（5个文件夹）
```
output/run_YYYYMMDD_HHMMSS/
├── 01_MIR_Results/      # MIR 结果
├── 02_GTS_Files/        # GTS 文件
├── 03_Validation/       # 验证文件
├── 04_Exports/          # 导出文件
└── 05_Debug/            # 调试文件
```

### 新结构（3个文件夹）
```
output/run_YYYYMMDD_HHMMSS/
├── MIR/                 # MIR 相关（结果 + 验证）
├── Spark/               # Spark 相关
└── GTS/                 # GTS 相关
```

## 主要改进

### 1. 简化目录结构
- **从 5 个文件夹减少到 3 个**
- 更清晰的文件分类
- 更容易查找文件

### 2. Mole 验证和输出合并
- **验证信息**和**MIR 结果**现在保存在**同一个 Excel 文件**的不同 sheet 中
- Excel 文件包含以下工作表：
  - `Summary by Source Lot` - MIR 结果总结
  - `Unit Comparison Details` - 详细的 Unit 对比
  - `Unmatched Units` - 不匹配的 Units（如果有）

### 3. 文件分类更清晰
- **MIR/** - 所有 MIR 相关文件（结果、验证、导出）
- **Spark/** - 所有 Spark 相关文件（合并文件、配置等）
- **GTS/** - 所有 GTS 相关文件（填充文件、模板等）

## 向后兼容

代码已添加向后兼容支持：
- 仍能识别旧的目录结构（`01_MIR_Results`, `02_GTS_Files` 等）
- 自动适配新旧目录结构
- 逐步迁移到新结构

## 文件位置变更

### MIR 相关文件
- **旧位置**: `output/run_*/01_MIR_Results/`
- **新位置**: `output/run_*/MIR/`
- **文件类型**:
  - `MIR_Results_*.xlsx` - MIR 结果（包含多个 sheet）
  - `MIR_Results_*.csv` - MIR 结果（CSV 格式）
  - `MIR_Results_with_VPO_*.xlsx` - 包含 VPO 的 MIR 结果

### Spark 相关文件
- **旧位置**: `output/`（根目录）
- **新位置**: `output/run_*/Spark/`
- **文件类型**:
  - `MIR_Results_For_Spark_*.xlsx` - MIR + For Spark.csv 合并文件

### GTS 相关文件
- **旧位置**: `output/run_*/02_GTS_Files/`
- **新位置**: `output/run_*/GTS/`
- **文件类型**:
  - `GTS_Submit_filled_*.xlsx` - GTS 填充文件

## 代码变更

### workflow_main.py
- `_create_work_directory()` - 修改目录创建逻辑
- 所有文件保存路径已更新
- 文件查找逻辑已更新

### gts_submitter.py
- `find_latest_excel()` - 支持新旧目录结构

### test_spark.py
- 文件查找逻辑已更新

## 使用建议

1. **新运行**：自动使用新目录结构
2. **旧文件**：仍可正常访问（向后兼容）
3. **清理**：可以删除旧的 `run_*` 目录，释放空间

## 注意事项

- 调试截图仍保存在 `output/05_Debug/`（如果使用旧代码）
- 建议更新所有引用旧目录的脚本
- 新运行会自动使用新结构

