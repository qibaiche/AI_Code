# 使用示例

## 基本使用流程

### 1. 准备Excel文件

创建一个Excel文件（例如 `input_data.xlsx`），包含需要处理的数据。例如：

| LOT | Device | Test_Result | Value |
|-----|--------|-------------|-------|
| P540451CR | Device1 | PASS | 1.5 |
| P540420CR | Device2 | PASS | 2.3 |

### 2. 配置工具

编辑 `config.yaml`：

```yaml
mole:
  executable_path: "C:/Program Files/Mole/Mole.exe"
  window_title: "Mole"

spark:
  url: "https://spark.internal.company.com"

gts:
  url: "https://gts.internal.company.com"
```

### 3. 运行工具

双击 `运行工作流.bat` 或在命令行运行：

```bash
python -m workflow_automation.main
```

### 4. 选择文件

- 如果系统支持GUI，会弹出文件选择对话框
- 否则，在命令行输入文件路径或拖拽文件

### 5. 查看结果

- 成功：生成 `workflow_result_YYYYMMDD.xlsx`
- 错误：生成 `workflow_errors_YYYYMMDD.csv`（如果有错误）
- 日志：查看 `./logs/workflow_automation.log`

## 自定义数据提交逻辑

由于Mole工具、Spark网页和GTS网站的具体界面各不相同，你需要根据实际情况修改提交逻辑。

### 修改Mole工具提交逻辑

编辑 `mole_submitter.py` 中的 `submit_mir_data` 方法：

```python
def submit_mir_data(self, data: dict) -> bool:
    # 确保应用程序已启动
    self._ensure_application()
    
    # 根据实际Mole工具界面填写表单
    # 示例：查找输入框并填写数据
    try:
        # 查找输入框（根据实际界面修改）
        input_field = self._window.child_window(auto_id="txtLot")
        input_field.set_text(data.get('LOT', ''))
        
        # 点击提交按钮
        submit_btn = self._window.child_window(auto_id="btnSubmit")
        submit_btn.click()
        
        # 等待提交完成
        time.sleep(2)
        
        return True
    except Exception as e:
        LOGGER.error(f"提交数据失败: {e}")
        return False
```

### 修改Spark网页提交逻辑

编辑 `spark_submitter.py` 中的 `submit_vpo_data` 方法：

```python
def submit_vpo_data(self, data: dict) -> bool:
    # 初始化并导航到页面
    self._init_driver()
    self._navigate_to_page()
    
    try:
        # 根据实际网页表单填写数据
        # 示例：查找表单元素并填写
        lot_input = WebDriverWait(self._driver, 10).until(
            EC.presence_of_element_located((By.ID, "lot-input"))
        )
        lot_input.send_keys(data.get('LOT', ''))
        
        # 点击提交按钮
        submit_btn = self._driver.find_element(By.ID, "submit-btn")
        submit_btn.click()
        
        # 等待提交完成
        time.sleep(self.config.wait_after_submit)
        
        return True
    except Exception as e:
        LOGGER.error(f"提交数据失败: {e}")
        return False
```

### 修改GTS网站提交逻辑

类似地，编辑 `gts_submitter.py` 中的 `submit_final_data` 方法。

## 调试技巧

1. **使用非无头模式**：将 `headless: false` 查看浏览器行为
2. **增加等待时间**：如果页面加载慢，增加 `timeout` 和 `wait_after_submit`
3. **查看日志**：详细日志在 `./logs/workflow_automation.log`
4. **分步测试**：先单独测试每个提交器

## 常见问题

### Q: Mole工具窗口找不到
A: 检查 `window_title` 配置是否正确，使用Window Spy工具查看实际窗口标题

### Q: Spark/GTS网页无法加载
A: 检查URL是否正确，确认网络连接，可能需要VPN

### Q: 表单元素找不到
A: 使用浏览器开发者工具（F12）查看元素ID或选择器，更新代码中的定位方式

